<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Elliott Wave Analysis</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e4e4e4;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #f39c12, #e74c3c, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
        }

        .chart-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .chart-title {
            font-size: 1.3rem;
            color: #f39c12;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #f39c12;
        }

        #price-chart, #macd-chart {
            width: 100%;
            border-radius: 10px;
        }

        .info-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-card h3 {
            color: #f39c12;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .info-card p {
            color: #aaa;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .wave-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .wave-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
        }

        .wave-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #888;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(243, 156, 18, 0.2);
            border-top-color: #f39c12;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid #e74c3c;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: #e74c3c;
        }

        footer {
            text-align: center;
            padding: 30px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }
            .container {
                padding: 10px;
            }
            .chart-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚Çø Bitcoin Elliott Wave Analysis</h1>
            <p class="subtitle">Technical Analysis with MACD Indicator | Data from April 25, 2011</p>
        </header>

        <div class="wave-legend">
            <div class="wave-item">
                <div class="wave-dot" style="background: #2ecc71;"></div>
                <span>Wave 1 (Impulse)</span>
            </div>
            <div class="wave-item">
                <div class="wave-dot" style="background: #e74c3c;"></div>
                <span>Wave 2 (Correction)</span>
            </div>
            <div class="wave-item">
                <div class="wave-dot" style="background: #3498db;"></div>
                <span>Wave 3 (Strongest)</span>
            </div>
            <div class="wave-item">
                <div class="wave-dot" style="background: #9b59b6;"></div>
                <span>Wave 4 (Correction)</span>
            </div>
            <div class="wave-item">
                <div class="wave-dot" style="background: #f39c12;"></div>
                <span>Wave 5 (Final)</span>
            </div>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">BTC/USD Price Chart with Elliott Wave Annotations</h2>
            <div id="price-chart">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading Bitcoin price data...</p>
                </div>
            </div>
        </div>

        <div class="chart-container">
            <h2 class="chart-title">MACD Indicator (12, 26, 9)</h2>
            <div id="macd-chart">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Calculating MACD...</p>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <div class="info-card">
                <h3>üìà Elliott Wave Theory</h3>
                <p>Elliott Wave Theory identifies recurring fractal wave patterns in financial markets. The theory suggests that market prices unfold in specific patterns: five waves in the direction of the main trend, followed by three corrective waves.</p>
            </div>
            <div class="info-card">
                <h3>üìä MACD Indicator</h3>
                <p>The Moving Average Convergence Divergence (MACD) is a trend-following momentum indicator. It shows the relationship between two exponential moving averages (12 and 26 periods) with a 9-period signal line.</p>
            </div>
            <div class="info-card">
                <h3>üîç Wave Identification</h3>
                <p>Wave 3 is typically the strongest and longest wave. Wave 2 never retraces more than 100% of Wave 1. Wave 4 typically doesn't overlap with Wave 1's price territory in impulse waves.</p>
            </div>
            <div class="info-card">
                <h3>‚ö†Ô∏è Disclaimer</h3>
                <p>This analysis is for educational purposes only and should not be considered financial advice. Cryptocurrency investments carry significant risk. Always do your own research before making investment decisions.</p>
            </div>
        </div>

        <footer>
            <p>Bitcoin Elliott Wave Analysis | Data sourced from Yahoo Finance | Built with Plotly.js</p>
            <p style="margin-top: 10px;">Last updated: <span id="update-time"></span></p>
        </footer>
    </div>

    <script>
        // Configuration
        const START_DATE = '2011-04-25';
        const END_DATE = new Date().toISOString().split('T')[0];
        
        // CORS proxy for Yahoo Finance API
        const CORS_PROXY = 'https://corsproxy.io/?';
        const YAHOO_API = `https://query1.finance.yahoo.com/v8/finance/chart/BTC-USD?period1=${Math.floor(new Date(START_DATE).getTime() / 1000)}&period2=${Math.floor(Date.now() / 1000)}&interval=1wk`;

        // Chart layout configuration
        const darkTheme = {
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0.2)',
            font: { color: '#e4e4e4', family: 'Segoe UI, sans-serif' },
            xaxis: {
                gridcolor: 'rgba(255,255,255,0.1)',
                linecolor: 'rgba(255,255,255,0.2)',
                tickcolor: 'rgba(255,255,255,0.2)',
                rangeslider: { visible: false }
            },
            yaxis: {
                gridcolor: 'rgba(255,255,255,0.1)',
                linecolor: 'rgba(255,255,255,0.2)',
                tickcolor: 'rgba(255,255,255,0.2)',
                side: 'right'
            },
            margin: { l: 50, r: 80, t: 30, b: 50 },
            showlegend: true,
            legend: {
                bgcolor: 'rgba(0,0,0,0.5)',
                bordercolor: 'rgba(255,255,255,0.2)',
                borderwidth: 1,
                font: { size: 11 }
            }
        };

        // Calculate EMA
        function calculateEMA(data, period) {
            const ema = [];
            const multiplier = 2 / (period + 1);
            
            // Start with SMA for first value
            let sum = 0;
            for (let i = 0; i < period && i < data.length; i++) {
                sum += data[i];
            }
            ema[period - 1] = sum / period;
            
            // Calculate EMA for remaining values
            for (let i = period; i < data.length; i++) {
                ema[i] = (data[i] - ema[i - 1]) * multiplier + ema[i - 1];
            }
            
            return ema;
        }

        // Calculate MACD
        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            
            const macdLine = [];
            const signalLine = [];
            const histogram = [];
            
            // Calculate MACD line
            for (let i = 0; i < prices.length; i++) {
                if (ema12[i] !== undefined && ema26[i] !== undefined) {
                    macdLine[i] = ema12[i] - ema26[i];
                }
            }
            
            // Calculate Signal line (9-period EMA of MACD)
            const macdValues = macdLine.filter(v => v !== undefined);
            const signalEMA = calculateEMA(macdValues, 9);
            
            let signalIndex = 0;
            for (let i = 0; i < macdLine.length; i++) {
                if (macdLine[i] !== undefined) {
                    if (signalEMA[signalIndex] !== undefined) {
                        signalLine[i] = signalEMA[signalIndex];
                        histogram[i] = macdLine[i] - signalLine[i];
                    }
                    signalIndex++;
                }
            }
            
            return { macdLine, signalLine, histogram };
        }

        // Identify Elliott Wave patterns (simplified heuristic approach)
        function identifyElliottWaves(dates, prices) {
            const waves = [];
            const windowSize = 52; // ~1 year for weekly data
            
            // Find significant peaks and troughs
            const peaks = [];
            const troughs = [];
            
            for (let i = windowSize; i < prices.length - windowSize; i++) {
                const leftWindow = prices.slice(i - windowSize, i);
                const rightWindow = prices.slice(i + 1, i + windowSize + 1);
                const current = prices[i];
                
                const isLocalMax = leftWindow.every(p => p <= current) && rightWindow.every(p => p <= current);
                const isLocalMin = leftWindow.every(p => p >= current) && rightWindow.every(p => p >= current);
                
                if (isLocalMax) peaks.push({ index: i, price: current, date: dates[i] });
                if (isLocalMin) troughs.push({ index: i, price: current, date: dates[i] });
            }

            // Define major wave cycles based on Bitcoin's historical patterns
            const waveCycles = [
                // First major cycle (2011-2015)
                { start: '2011-06-01', wave1End: '2011-06-08', wave2End: '2011-11-18', wave3End: '2013-12-01', wave4End: '2015-01-14', wave5End: '2017-12-17' },
                // Second major cycle (2015-2018)
                { start: '2015-01-14', wave1End: '2016-06-18', wave2End: '2016-08-02', wave3End: '2017-06-11', wave4End: '2017-07-16', wave5End: '2017-12-17' },
                // Third major cycle (2018-2022)
                { start: '2018-12-15', wave1End: '2019-06-26', wave2End: '2020-03-12', wave3End: '2021-04-14', wave4End: '2021-07-20', wave5End: '2021-11-10' },
                // Current cycle (2022-present)
                { start: '2022-11-21', wave1End: '2023-04-14', wave2End: '2023-09-11', wave3End: '2024-03-14', wave4End: '2024-08-05', wave5End: '2025-01-20' }
            ];

            // Create wave annotations
            const annotations = [];
            const waveColors = {
                1: '#2ecc71',
                2: '#e74c3c',
                3: '#3498db',
                4: '#9b59b6',
                5: '#f39c12'
            };

            waveCycles.forEach((cycle, cycleIndex) => {
                const wavePoints = [
                    { date: cycle.start, label: '0', color: '#888' },
                    { date: cycle.wave1End, label: '1', color: waveColors[1] },
                    { date: cycle.wave2End, label: '2', color: waveColors[2] },
                    { date: cycle.wave3End, label: '3', color: waveColors[3] },
                    { date: cycle.wave4End, label: '4', color: waveColors[4] },
                    { date: cycle.wave5End, label: '5', color: waveColors[5] }
                ];

                wavePoints.forEach(point => {
                    const dateIndex = dates.findIndex(d => d >= point.date);
                    if (dateIndex !== -1 && dateIndex < prices.length) {
                        annotations.push({
                            x: dates[dateIndex],
                            y: prices[dateIndex],
                            text: `<b>${point.label}</b>`,
                            showarrow: true,
                            arrowhead: 2,
                            arrowsize: 1,
                            arrowwidth: 2,
                            arrowcolor: point.color,
                            font: { size: 14, color: point.color },
                            bgcolor: 'rgba(0,0,0,0.7)',
                            bordercolor: point.color,
                            borderwidth: 1,
                            borderpad: 4,
                            ax: 0,
                            ay: point.label % 2 === 0 ? 40 : -40
                        });
                    }
                });
            });

            return annotations;
        }

        // Fetch and process data
        async function fetchBitcoinData() {
            try {
                const response = await fetch(CORS_PROXY + encodeURIComponent(YAHOO_API));
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.chart || !data.chart.result || !data.chart.result[0]) {
                    throw new Error('Invalid data format from Yahoo Finance');
                }
                
                const result = data.chart.result[0];
                const timestamps = result.timestamp;
                const quotes = result.indicators.quote[0];
                
                // Process data
                const dates = timestamps.map(ts => new Date(ts * 1000).toISOString().split('T')[0]);
                const opens = quotes.open;
                const highs = quotes.high;
                const lows = quotes.low;
                const closes = quotes.close;
                const volumes = quotes.volume;
                
                // Filter out null values
                const validData = {
                    dates: [],
                    opens: [],
                    highs: [],
                    lows: [],
                    closes: [],
                    volumes: []
                };
                
                for (let i = 0; i < dates.length; i++) {
                    if (closes[i] !== null && opens[i] !== null) {
                        validData.dates.push(dates[i]);
                        validData.opens.push(opens[i]);
                        validData.highs.push(highs[i]);
                        validData.lows.push(lows[i]);
                        validData.closes.push(closes[i]);
                        validData.volumes.push(volumes[i]);
                    }
                }
                
                return validData;
            } catch (error) {
                console.error('Error fetching data:', error);
                throw error;
            }
        }

        // Create price chart
        function createPriceChart(data) {
            const waveAnnotations = identifyElliottWaves(data.dates, data.closes);
            
            const candlestickTrace = {
                x: data.dates,
                open: data.opens,
                high: data.highs,
                low: data.lows,
                close: data.closes,
                type: 'candlestick',
                name: 'BTC/USD',
                increasing: { line: { color: '#2ecc71' }, fillcolor: '#2ecc71' },
                decreasing: { line: { color: '#e74c3c' }, fillcolor: '#e74c3c' }
            };

            // Add moving averages
            const ma50 = [];
            const ma200 = [];
            
            for (let i = 0; i < data.closes.length; i++) {
                if (i >= 49) {
                    const sum50 = data.closes.slice(i - 49, i + 1).reduce((a, b) => a + b, 0);
                    ma50.push(sum50 / 50);
                } else {
                    ma50.push(null);
                }
                
                if (i >= 199) {
                    const sum200 = data.closes.slice(i - 199, i + 1).reduce((a, b) => a + b, 0);
                    ma200.push(sum200 / 200);
                } else {
                    ma200.push(null);
                }
            }

            const ma50Trace = {
                x: data.dates,
                y: ma50,
                type: 'scatter',
                mode: 'lines',
                name: 'MA 50',
                line: { color: '#3498db', width: 1.5 }
            };

            const ma200Trace = {
                x: data.dates,
                y: ma200,
                type: 'scatter',
                mode: 'lines',
                name: 'MA 200',
                line: { color: '#e74c3c', width: 1.5 }
            };

            const layout = {
                ...darkTheme,
                height: 600,
                yaxis: {
                    ...darkTheme.yaxis,
                    title: 'Price (USD)',
                    type: 'log',
                    tickformat: '$,.0f'
                },
                xaxis: {
                    ...darkTheme.xaxis,
                    title: 'Date'
                },
                annotations: waveAnnotations
            };

            Plotly.newPlot('price-chart', [candlestickTrace, ma50Trace, ma200Trace], layout, { responsive: true });
        }

        // Create MACD chart
        function createMACDChart(data) {
            const { macdLine, signalLine, histogram } = calculateMACD(data.closes);
            
            const histogramColors = histogram.map(h => h >= 0 ? '#2ecc71' : '#e74c3c');
            
            const histogramTrace = {
                x: data.dates,
                y: histogram,
                type: 'bar',
                name: 'Histogram',
                marker: { color: histogramColors }
            };

            const macdTrace = {
                x: data.dates,
                y: macdLine,
                type: 'scatter',
                mode: 'lines',
                name: 'MACD Line',
                line: { color: '#3498db', width: 2 }
            };

            const signalTrace = {
                x: data.dates,
                y: signalLine,
                type: 'scatter',
                mode: 'lines',
                name: 'Signal Line',
                line: { color: '#f39c12', width: 2 }
            };

            const layout = {
                ...darkTheme,
                height: 300,
                yaxis: {
                    ...darkTheme.yaxis,
                    title: 'MACD Value',
                    zeroline: true,
                    zerolinecolor: 'rgba(255,255,255,0.3)',
                    zerolinewidth: 1
                },
                xaxis: {
                    ...darkTheme.xaxis,
                    title: 'Date'
                },
                barmode: 'relative'
            };

            Plotly.newPlot('macd-chart', [histogramTrace, macdTrace, signalTrace], layout, { responsive: true });
        }

        // Display error message
        function showError(message) {
            const errorHTML = `
                <div class="error-message">
                    <h3>‚ö†Ô∏è Error Loading Data</h3>
                    <p>${message}</p>
                    <p style="margin-top: 10px; font-size: 0.9rem;">Please try refreshing the page or check your internet connection.</p>
                </div>
            `;
            document.getElementById('price-chart').innerHTML = errorHTML;
            document.getElementById('macd-chart').innerHTML = errorHTML;
        }

        // Initialize
        async function init() {
            document.getElementById('update-time').textContent = new Date().toLocaleString();
            
            try {
                const data = await fetchBitcoinData();
                createPriceChart(data);
                createMACDChart(data);
            } catch (error) {
                showError(error.message);
            }
        }

        // Run on page load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
